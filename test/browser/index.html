<!DOCTYPE html>
<html>

  <head>

  </head>

  <body>
    <p>Watch the data load incrementally. Status: <span id="display-status" style="font-size: 14px;">waiting</span></p>
    <p id="display-running-content" style="font-size: 10px;">Nothing yet...</p>

    <script src="superagent-get-chunked.js"></script>
    <script>
      var inputs = [{
        accept: 'text/tab-separated-values',
        url: 'http://webservice.bridgedb.org/Human/xrefs/L/4292',
        fontSize: '10px',
      }, {
        // large file!
        accept: 'tsv',
        url: 'https://cdn.rawgit.com/nrnb/mirna-pathway-finder/master/wp-mir-table-builder/mir-gene-targets.txt',
        fontSize: '1px',
      }, {
        accept: 'json',
        url: 'https://publicdata-weather.firebaseio.com/sanfrancisco/.json',
        fontSize: '8px',
      }, {
        accept: 'ndjson',
        url: 'https://cdn.rawgit.com/maxogden/sqlite-search/master/test.ndjson',
        fontSize: '4px',
      }, {
        accept: 'n3',
        url: 'https://cdn.rawgit.com/simeonackermann/VocTo/master/data/example.n3',
        fontSize: '4px',
      }, {
        // large file!
        accept: 'n3',
        url: 'https://cdn.rawgit.com/ruby-rdf/rdf-n3/develop/example-files/sp2b.n3',
        fontSize: '1px',
      }];

      var selectedInput = inputs[2];

      var status = 'loading';
      var statusP = document.querySelector('#display-status');

      statusP.textContent = status + ' at ' + new Date().toISOString();

      function showStatus() {
        window.setTimeout(function() {
          if (status === 'loading') {
            window.requestAnimationFrame(function() {
              statusP.textContent = status + ' at ' + new Date().toISOString();
              showStatus();
            });
          }
        }, 50);
      }
      showStatus();

      var contentP = document.querySelector('#display-running-content');
      var runningContent = '';

      contentP.style.fontSize = selectedInput.fontSize;
      contentP.style.backgroundColor = 'lightgreen';

      request
      .get(selectedInput.url)
      .accept(selectedInput.accept)
      .on('data', function(data) {
        console.log('data received');
        //console.log(data);
        runningContent += JSON.stringify(data, null, '  ');
        window.requestAnimationFrame(function() {
          contentP.textContent = runningContent;
        });
      })
      .on('error', function(err) {
        throw err;
      })
      .on('end', function() {
        status = 'complete';
        statusP.textContent = status;
        console.log(status);
      })
      .end();
    </script>
  </body>

</html>
